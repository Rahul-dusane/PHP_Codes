<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <table width="100%" height="100%" border="1" cellspacing="10" cellpadding="10">
        <tr>
            <td width="250" valign="top">
                <h3>User Menu</h3>
                <ul>
                    <li><a href="javascript:void(0)" onclick="loadWelcome()">Welcome</a></li>
                    <div id="categoryTree"></div>
                    <li><a href="../Login/Login.html" target="_top">Logout</a></li>
                </ul>
            </td>

            <td valign="top">
                <iframe name="contentFrame" id="contentFrame" width="100%" height="600px" frameborder="0"
                    srcdoc="<h2>Welcome to User Dashboard</h2><p>Select an option from the left menu.</p>">

                </iframe>
            </td>
        </tr>
    </table>

    <script>

        $(document).ready(function () {
            loadCategories();
        })

        function loadWelcome() {
            $("#contentFrame").attr("srcdoc", "<h2>Welcome to User Dashboard</h2><p>Select an option from the left menu.</p>");
        }

        function loadCategories() {
            $.ajax({
                url: "ClientIndex.php",
                type: "GET",
                dataType: "json",
                success: function (response) {
                    if (response.status === "success") {
                        let html = "";
                        response.data.forEach(cat => {
                            html += `<li> <details> <summary>${cat.name}</summary><ul>`;
                            cat.products.forEach(p => {
                                html += `<li><a href="javascript:void(0)" onclick="loadProduct(${p.product_id})">${p.product_name} </a></li>`;
                            });
                            html += `</ul></details></li>`;

                        });
                        $("#categoryTree").html(html);
                    } else {
                        $("#categoryTree").html("<li>No Category Found</li>");
                    }
                },
                error: function (xhr, status, error) {
                    console.log("Error: ", error);
                }
            });
        }

        

        function loadProduct(productId) {
            $.ajax({
                url: "ClientIndex.php",
                type: "GET",
                data: { product_id: productId },
                dataType: "json",
                success: function (response) {
                    if (response.status === "success") {
                        let p = response.data;
                        let content = `<h2>${p.product_name}</h2>
                        <img src="${p.image_url}" width="150"><br>
                        <b>Price:</b>${p.price}<br>
                        <p>${p.description}</p>
                        <br>
                        <input type="number" id="quantity_${p.product_id}" value="1" min="1" style="width: 60px; margin-right: 10px;">
                        <button onclick="addToCart(${p.product_id})" style="background-color: #4CAF50; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">Add to Cart</button>
                        <div id="cart_message_${p.product_id}" style="margin-top: 10px;"></div>`;

                        

                        $("#contentFrame").attr("srcdoc", content);
                    } else {
                        $("#contentFrame").attr("srcdoc","<p>Product not found.</p>");
                    }
                },
                error: function(xhr,status,error){
                    console.error("Error Loading Product: ",error);
                }
            });
        }
    </script>

</body>

</html>